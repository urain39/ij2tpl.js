!function(e){if("object"==typeof module&&"object"==typeof module.exports){var r=e(require,exports);void 0!==r&&(module.exports=r)}else"function"==typeof define&&define.amd&&define(["require","exports"],e)}(function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var h={"?":0,"!":1,"*":2,"/":3,"#":5};function a(e,r,t){for(var n,a,o=[],i=0,s=0;i<e.length;){if(-1===(s=e.indexOf(r,i))){0<(a=e.slice(i,e.length)).length&&o.push([4,a,void 0,void 0]);break}if(a=e.slice(i,s),s+=r.length,0<a.length&&o.push([4,a,void 0,void 0]),-1===(i=e.indexOf(t,s)))throw new SyntaxError("No match prefix '"+r+"'");if(a=e.slice(s,i),i+=t.length,!(a.length<1))switch(n=a[0]){case"?":case"!":case"*":case"/":case"#":o.push([h[n],a.slice(1),void 0,void 0]);break;case"-":break;default:o.push([6,a,void 0,void 0])}}return o}var l=(t.prototype.resolve=function(e){for(var r=null,t=!1,n=this;n;n=n.parent)if(n.cache.hasOwnProperty(e)){t=!0,r=n.cache[e];break}if(!t){if(0<e.indexOf(".")){var a=e.split(".");for(n=this;n;n=n.parent)if(n.data&&n.data.hasOwnProperty&&n.data.hasOwnProperty(a[0])){r=n.data[a[0]];for(var o=0,i=a.slice(1);o<i.length;o++){var s=i[o];if(!(r&&r.hasOwnProperty&&r.hasOwnProperty(s))){r=null;break}r=r[s]}break}}else for(n=this;n;n=n.parent)if(n.data&&n.data.hasOwnProperty&&n.data.hasOwnProperty(e)){r=n.data[e];break}this.cache[e]=r=r||null}return r},t);function t(e,r){this.data=e,this.parent=r,this.cache={".":this.data}}var o=(n.prototype.renderTree=function(e,r){for(var t,n,a=[],o=0,i=e;o<i.length;o++){var s=i[o];switch(s[0]){case 0:if(!(t=r.resolve(s[1])))continue;if(t instanceof Array)for(var h=0,c=t;h<c.length;h++){var f=c[h];a.push(this.renderTree(s[2],new l(f,r)).join(""))}else a.push(this.renderTree(s[2],new l(t,r)).join(""));break;case 1:if(t=r.resolve(s[1]))continue;a.push(this.renderTree(s[2],r).join(""));break;case 2:if(t=r.resolve(s[1]))if(t instanceof Array)for(var p=0,u=t;p<u.length;p++)f=u[p],a.push(this.renderTree(s[2],new l(f,r)).join(""));else a.push(this.renderTree(s[2],new l(t,r)).join(""));else a.push(this.renderTree(s[3],r).join(""));break;case 4:a.push(s[1]);break;case 5:a.push(r.resolve(s[1]));break;case 6:a.push((n=r.resolve(s[1]),String(n).replace(/[&<>"'`=\/]/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#x60;","=":"&#x3D;","/":"&#x2F;"}[e]})))}}return a},n.prototype.render=function(e){return this.renderTree(this.treeRoot,new l(e,null)).join("")},n);function n(e){this.treeRoot=e}r.IJ2TPL={parse:function(e,r,t){void 0===r&&(r="{"),void 0===t&&(t="}");var n=function(e){for(var r,t=[],n=[],a=n,o=0,i=e;o<i.length;o++){var s=i[o];switch(s[0]){case 0:case 1:a.push(s),r=s,t.push(r),a=r[2]=[];break;case 2:if(!(r=t[t.length-1])||0!==r[0]||s[1]!==r[1])throw new SyntaxError("Unexpected token '<type="+s[0]+", value="+s[1]+">'");a=r[3]=[];break;case 3:if(!(r=t.pop())||s[1]!==r[1])throw new SyntaxError("Unexpected token '<type="+s[0]+", value="+s[1]+">'");r[3]instanceof Array&&0<r[3].length&&(r[0]=2),a=0<t.length?(r=t[t.length-1])[3]instanceof Array?r[3]:r[2]:n;break;default:a.push(s)}}if(0<t.length)throw r=t.pop(),new SyntaxError("No match section '<type="+r[0]+", value="+r[1]+">'");return n}(a(e,r,t));return new o(n)},tokenize:a,Context:l,Renderer:o}});