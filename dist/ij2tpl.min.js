(function(e){typeof define==="function"&&define.amd?define(e):e()})(function(){"use strict";var e;exports.__esModule=true;exports.parse=exports.Renderer=exports.Context=exports.escapeHTML=exports.tokenize=exports.version=void 0;exports.version="0.1.0-dev";if(!Array.isArray){var r={}.toString;Array.isArray=function(e){return r.call(e)==="[object Array]"}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0\uFEFF]+|[\s\xA0\uFEFF]+$/g,"")}}var u={"?":0,"!":1,"*":2,"/":3,"#":5};function a(e,r,t){var n,a,i=[7,"^"],s=[];for(var o=0,f=0,c=e.length,l=r.length,p=t.length;o<c;){f=e.indexOf(r,o);if(f===-1){a=e.slice(o);if(a)i=[4,a],s.push(i);break}a=e.slice(o,f);f+=l;if(a)i=[4,a],s.push(i);o=e.indexOf(t,f);if(o===-1)throw new SyntaxError("No matching prefix '"+r+"'");a=e.slice(f,o);o+=p;if(!a)continue;a=a.trim();n=a[0];switch(n){case"?":case"!":case"*":case"/":if(i[0]===4){if(/(?:^|[\n\r])[\t \xA0\uFEFF]+$/.test(i[1]))i[1]=i[1].replace(/[\t \xA0\uFEFF]+$/g,"");if(!i[1])s.pop()}if(o<c){switch(e[o]){case"\n":o+=1;break;case"\r":o+=e.charAt(o+1)==="\n"?2:1;break}}case"#":a=a.slice(1).trim();i=[u[n],a],s.push(i);break;case"-":break;default:i=[6,a],s.push(i);break}}return s}exports.tokenize=a;var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#x60;","=":"&#x3D;","/":"&#x2F;"};function h(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return t[e]})}exports.escapeHTML=h;var c={}.hasOwnProperty;var v=function(){function e(e,r){this.data=e;this.parent=r;this.cache={".":this.data}}e.prototype.resolve=function(e){var r,t,n=null,a=this;t=a.cache;if(c.call(t,e)){n=t[e]}else{if(e.indexOf(".")>0){var i=void 0,s=e.split(".");i=s[0];for(;a;a=a.parent){r=a.data;if(r&&c.call(r,i)){n=r[i];for(var o=1,f=s.length;o<f;o++){i=s[o];if(n&&c.call(n,i)){n=n[i]}else{n=null;break}}break}}}else{for(;a;a=a.parent){r=a.data;if(r&&c.call(r,e)){n=r[e];break}}}if(typeof n==="function")n=n(a);t[e]=n}return n};return e}();exports.Context=v;var i=function(){function e(e){this.treeRoot=e}e.prototype.renderTree=function(e,r){var t,n="";for(var a=0,i=e;a<i.length;a++){var s=i[a];switch(s[0]){case 0:t=r.resolve(s[1]);if(t){if(Array.isArray(t))for(var o=0,f=t;o<f.length;o++){var c=f[o];n+=this.renderTree(s[2],new v(c,r))}else n+=this.renderTree(s[2],new v(t,r))}break;case 1:t=r.resolve(s[1]);if(!t||Array.isArray(t)&&t.length<1)n+=this.renderTree(s[2],r);break;case 2:t=r.resolve(s[1]);if(t){if(Array.isArray(t))for(var l=0,p=t;l<p.length;l++){var c=p[l];n+=this.renderTree(s[2],new v(c,r))}else n+=this.renderTree(s[2],new v(t,r))}else{n+=this.renderTree(s[3],r)}break;case 4:n+=s[1];break;case 5:t=r.resolve(s[1]);if(t!=null)n+=t;break;case 6:t=r.resolve(s[1]);if(t!=null)n+=typeof t==="number"?t:h(t);break}}return n};e.prototype.render=function(e){return this.renderTree(this.treeRoot,new v(e,null))};return e}();exports.Renderer=i;var f=(e={},e[0]="?",e[1]="!",e[2]="*",e[3]="/",e[5]="#",e);function s(e){var r,t=[],n=[],a=n;for(var i=0,s=e;i<s.length;i++){var o=s[i];switch(o[0]){case 0:case 1:a.push(o);r=o;t.push(r);a=r[2]=[];break;case 2:r=t.length>0?t[t.length-1]:void 0;if(!r||r[0]!==0||o[1]!==r[1])throw new SyntaxError("Unexpected token '<type="+f[o[0]]+", value="+o[1]+">'");a=r[3]=[];break;case 3:r=t.pop();if(!r||o[1]!==r[1])throw new SyntaxError("Unexpected token '<type="+f[o[0]]+", value="+o[1]+">'");if(Array.isArray(r[3])&&r[3].length>0)r[0]=2;if(t.length>0)a=(r=t[t.length-1],Array.isArray(r[3]))?r[3]:r[2];else a=n;break;default:a.push(o);break}}if(t.length>0){r=t.pop();throw new SyntaxError("No matching section '<type="+f[r[0]]+", value="+r[1]+">'")}return n}function n(e,r,t){if(r===void 0){r="{"}if(t===void 0){t="}"}var n=s(a(e,r,t));return new i(n)}exports.parse=n});