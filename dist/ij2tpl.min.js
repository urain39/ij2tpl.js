(function(){function e(e){"use strict";function h(e){return e.replace(n,"")}function p(e,r){4===e[0]&&(a.test(e[1])&&(e[1]=e[1].replace(i,"")),e[1]||r.pop())}var r,t,d={},v=((r={})["?"]=0,r["!"]=1,r["*"]=2,r["/"]=3,r["#"]=5,r["@"]=8,r),n=/[\s\xA0\uFEFF]+/g,a=/(?:^|[\n\r])[\t \xA0\uFEFF]+$/,i=/[\t \xA0\uFEFF]+$/;function u(e,r,t){for(var n,a,i=[7,""],o=[],l=0,s=0,c=e.length,f=r.length,u=t.length;l<c;){if(-1===(s=e.indexOf(r,l))){(a=e.slice(l))&&(i=[4,a],o.push(i));break}if(a=e.slice(l,s),s+=f,a&&(i=[4,a],o.push(i)),-1===(l=e.indexOf(t,s)))throw new Error("No matching prefix '"+r+"'");if("-"!==e[s]){if(a=e.slice(s,l),l+=u,a=h(a))switch(n=a[0]){case"?":case"!":case"*":case"/":case"@":if(p(i,o),l<c)switch(e[l]){case"\n":l+=1;break;case"\r":l+=l+1<c&&"\n"===e[l+1]?2:1}case"#":a=h(a.slice(1)),i=[v[n],a],o.push(i);break;default:i=[6,a],o.push(i)}}else p(i,o),l+=u}return o}function g(e){return String(e).replace(o,function(e){return l[e]})}var o=/["&'\/<=>`]/g,l={'"':"&quot;","&":"&amp;","'":"&#39;","/":"&#x2F;","<":"&lt;","=":"&#x3D;",">":"&gt;","`":"&#x60;"},s=g,w={}.hasOwnProperty,b={"":!0},k=(c.prototype.resolve=function(e){var r,t,n=null,a=this,i=a.cache,o=e[0];if(w.call(i,o))n=i[o];else if(!b[o]){if(e[1]){o=(t=e[1])[0];do{if((r=a.data)&&w.call(r,o)){n=r[o];for(var l=1,s=t.length;l<s;l++){if(o=t[l],!n||!w.call(n,o)){n=null;break}n=n[o]}break}a=a.parent}while(a)}else do{if((r=a.data)&&w.call(r,o)){n=r[o];break}a=a.parent}while(a);"function"==typeof n&&(n=n(a)),i[o]=n}if(e[2])for(var c=0,f=e[2];c<f.length;c++){var u=f[c];if(!w.call(d,u))throw new Error("Cannot resolve filter '"+u+"'");n=d[u](n)}return n},c);function c(e,r){this.data=e,this.parent=r,this.cache={".":this.data}}var f,y=Array.isArray;y||(f={}.toString,y=function(e){return"[object Array]"===f.call(e)});var x=(F.prototype.renderTree=function(e,r,t){for(var n,a,i="",o=!1,l=0,s=e;l<s.length;l++){var c=s[l];switch(c[0]){case 0:if(a=c,n=r.resolve(a[1]),(o=y(n))?n.length:n)if(o)for(var f=0,u=n;f<u.length;f++){var h=u[f];i+=this.renderTree(a[2],new k(h,r),t)}else i+=this.renderTree(a[2],new k(n,r),t);break;case 1:a=c,n=r.resolve(a[1]),((o=y(n))?n.length:n)||(i+=this.renderTree(a[2],r,t));break;case 2:if(a=c,n=r.resolve(a[1]),(o=y(n))?n.length:n)if(o)for(var p=0,d=n;p<d.length;p++)h=d[p],i+=this.renderTree(a[2],new k(h,r),t);else i+=this.renderTree(a[2],new k(n,r),t);else i+=this.renderTree(a[3],r,t);break;case 4:i+=n=c[1];break;case 5:null!=(n=r.resolve(c[1]))&&(i+=n);break;case 6:null!=(n=r.resolve(c[1]))&&(i+="number"==typeof n?n:g(n));break;case 8:if(n=c[1],!t||!w.call(t,n))throw new Error("Cannot resolve partial '"+n+"'");i+=this.renderTree(t[n].treeRoot,r,t)}}return i},F.prototype.render=function(e,r){return this.renderTree(this.treeRoot,new k(e,null),r)},F);function F(e){this.treeRoot=e}function T(e){var r=null,t=null,n=e[1];return-1!==n.indexOf("|")&&(n=(t=n.split("|"))[0],t=t.slice(1)),0<n.indexOf(".")&&(r=n.split(".")),[e[0],[n,r,t]]}var E=((t={})[0]="?",t[1]="!",t[2]="*",t[3]="/",t);Object.defineProperty||(Object.defineProperty=function(){}),e.ActionNames=b,e.Context=k,e.Renderer=x,e.escape=s,e.parse=function(s,c,f){void 0===c&&(c="{"),void 0===f&&(f="}");var e=function(){for(var e,r,t=[],n=[],a=n,i=0,o=u(s,c,f);i<o.length;i++){var l=o[i];switch(l[0]){case 0:case 1:e=T(l),a.push(e),r=e,t.push(r),a=r[2]=[],r[3]=null;break;case 2:if(!(r=t.length?t[t.length-1]:void 0)||0!==r[0]||l[1]!==r[1][0])throw new Error("Unexpected token '<type="+E[l[0]]+", value="+l[1][0]+">'");a=r[3]=[];break;case 3:if(!(r=t.pop())||l[1]!==r[1][0])throw new Error("Unexpected token '<type="+E[l[0]]+", value="+l[1][0]+">'");y(r[3])&&r[3].length&&(r[0]=2),a=t.length?(r=t[t.length-1],y(r[3])?r[3]:r[2]):n;break;case 5:case 6:e=T(l),a.push(e);break;default:a.push(l)}}if(t.length)throw r=t.pop(),new Error("No matching section '<type="+E[r[0]]+", value="+r[1][0]+">'");return n}();return new x(e)},e.setFilterMap=function(e){d=e},e.tokenize=u,e.version="0.1.0-dev",Object.defineProperty(e,"__esModule",{value:!0})}var r=this;"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((r=r||self).IJ2TPL={})})();